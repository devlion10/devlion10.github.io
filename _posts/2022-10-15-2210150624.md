---
layout: post
title:  "Docker에 설치된 gitlab, jenkins 연동 후 jeus8 deploy CI,CD 환경 구축"
---

# Docker에 설치된 gitlab, jenkins 연동 후 jeus8 deploy CI,CD 환경 구축

**gitlab accesstoken 정책 변경으로 jenkins에서 인증 오류 발생하여 리눅스 쉘스크립트로 gitlab git pull 작업 작성**



- docker jenkins컨테이너의 젠킨스홈/workspace/item이름/ 경로의gitlab git pull sh파일 작성 

```git
git init
git remote add origin 깃랩url
git pull origin master
```

- 젠킨스 파이프라인
```xml
pipeline {
    agent any

      tools {
        // Install the Maven version configured as "M3" and add it to the path.
        maven "M3"
        jdk "openJDK1.8"
    }

    stages {
        stage('Prepare') {
            steps {
                // get code from Git repository
                //git branch: 'master', credentialsId: 'gitlab-srd2021', url: 'http://203.236.216.172:8091/srd2021/SRD-LIC.git'
				//credentialsId연결 테스트 성공하지만 이단계에서 계속 인증오류 발생
                sh '/var/jenkins_home/workspace/SRD-LIC/srd-git.sh'
            }
        }
        stage('Build') {
            steps {
                // Run Maven on a Unix agent.
                configFileProvider([configFile(fileId: '032ef104-0620-4200-a0d3-56ac46253a90', variable: 'mavensettings')]) {
                    sh "mvn -s $mavensettings -Dmaven.test.failure.ignore=true clean package"
                }
                
                // To run Maven on a Windows agent, use
                // bat "mvn -Dmaven.test.failure.ignore=true clean package"
            }

            post {
                // If Maven was able to run the tests, even if some of the test
                // failed, record the test results and archive the jar file.
                success {
                    //junit '**/target/surefire-reports/TEST-*.xml'
                    archiveArtifacts 'target/SRD-LIC.war'
                }
            }
        }
        stage('import JEUS') {
            steps {
	
				sh '/var/jenkins_home/jeusDeployLIC.sh'
			
			}
        }
      
        
    
    }
}
```

globals.properties
```xml
srd.apiUrl=:10030/api
### MAP URL ###
srd.mapUrl=https://roaddig.ss.eseoul.go.kr:10060/G2DataService/GService
srd.mapServiceUrl=https://roaddig.ss.eseoul.go.kr:10060
```

jsp
```jsp
<script type="text/javascript">
let CONTEXT_PATH = "${pageContext.request.contextPath}";
let API_PATH = '<%=(InetAddress.getLocalHost().getHostName().contains("roaddig"))?"https://"+InetAddress.getLocalHost().getHostName()+EgovProperties.getProperty("srd.apiUrl"):EgovProperties.getProperty("srd.apiUrl")%>';
let mapUrl = '<spring:eval expression="@srdProp.getProperty('srd.mapUrl')"/>';
let mapServiceUrl = '<spring:eval expression="@srdProp.getProperty('srd.mapServiceUrl')"/>';
</script>
```




    
                
