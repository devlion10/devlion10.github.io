---
layout: post
title:  "Docker에 설치된 gitlab, jenkins 연동 후 jeus8 deploy CI,CD 환경 구축"
---

# Docker에 설치된 gitlab, jenkins 연동 후 jeus8 deploy CI,CD 환경 구축

**gitlab accesstoken 정책 변경으로 jenkins에서 인증 오류 발생하여 리눅스 쉘스크립트로 gitlab git pull 작업 작성**



- docker jenkins컨테이너의 젠킨스홈/workspace/item이름/ 경로의gitlab git pull sh파일 작성

```git
git init
git remote add origin 깃랩url
git pull origin master
```

- 젠킨스 파이프라인, 깃풀, maven으로 와르 파일 생성, 제우스 redeploy
```xml
pipeline {
    agent any

      tools {
        // Install the Maven version configured as "M3" and add it to the path.
        maven "M3"
        jdk "openJDK1.8"
    }

    stages {
        stage('Prepare') {
            steps {
                // get code from Git repository
                //git branch: 'master', credentialsId: 'gitlab-srd2021', url: 'http://203.236.216.172:8091/srd2021/SRD-LIC.git'
				//credentialsId연결 테스트 성공하지만 이단계에서 계속 인증오류 발생
                sh '/var/jenkins_home/workspace/SRD-LIC/srd-git.sh'
            }
        }
        stage('Build') {
            steps {
                // Run Maven on a Unix agent.
                configFileProvider([configFile(fileId: '032ef104-0620-4200-a0d3-56ac46253a90', variable: 'mavensettings')]) {
                    sh "mvn -s $mavensettings -Dmaven.test.failure.ignore=true clean package"
                }
                
                // To run Maven on a Windows agent, use
                // bat "mvn -Dmaven.test.failure.ignore=true clean package"
            }

            post {
                // If Maven was able to run the tests, even if some of the test
                // failed, record the test results and archive the jar file.
                success {
                    //junit '**/target/surefire-reports/TEST-*.xml'
                    archiveArtifacts 'target/SRD-LIC.war'
                }
            }
        }
        stage('import JEUS') {
            steps {
	
				sh '/var/jenkins_home/jeusDeployLIC.sh'
			
			}
        }
      
        
    
    }
}
```

- docker 컨테이너와 local에 마운트된 경로에서 실행 (제우스는 도커 외부에 존재하기 떄문,
- shpass로 외부로 비밀번호 재요청 하지 않고 접속 /var/jenkins_home/jeusDeployLIC.sh)

```bash
#!/bin/sh
cp -rf /var/jenkins_home/workspace/SRD-LIC/target/SRD-LIC.war /var/jenkins_home

sshpass -p 'srd2021!@#$%' ssh root@203.236.216.179 "cp -rf /jenkins/SRD-LIC.war /home/was/jeus8/SRD/SRD-LIC && cd /home/was/jeus8/bin
./jeusadmin -u administrator -p 'srd2021!@#$' 'redeploy-application SRD-LIC' "
```






    
                
